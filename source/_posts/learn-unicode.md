title: 学习字符集编码
date: 2015-12-08 16:30:42
tags:
- Javascript
- Unicode
---
曾近有段时间在学php的时候，总是会碰到往数据库中插入数据乱码问题。前几天JSP老师在课上演示往SQLServer中插入数据，结果也是乱码一大堆了，调试了很久才正常。"字符乱码问题会伴随你们的程序人生"，他说这是这节课最重要的知识点。所以，身为一名未来的程序员，必要的字符编码知识是我们所必须掌握的。
<!--more-->
我们先来了解一下一些基本概念:
**字符集**：是一个系统支持的所有抽象字符的集合。字符是各种文字和符号的总称，包括各国家文字、标点符号、图形符号、数字等。
**字符集编码**：是一套法则，使用该法则能够对自然语言的字符的一个集合（如字母表或音节表），与其他东西的一个集合（如号码或电脉冲）进行配对。即在符号集合与数字系统之间建立对应关系，它是信息处理的一项基本技术。通常人们用符号集合（一般情况下就是文字）来表达信息。而以计算机为基础的信息处理系统则是利用元件（硬件）不同状态的组合来存储和处理信息的。元件不同状态的组合能代表数字系统的数字，因此字符编码就是将符号转换为计算机可以接受的数字系统的数，称为数字代码。
简单来说就是，在计算机内部，我们用0和1来表示数据，也就是二进制，我们把不同种类的语言和这种语言中的字符书写方式用某种规则转化成计算机能识别的二进制数据。
## ASIIC码
早期的计算机由于是美国人发明的，所以设计之初呢，美国人将英文中的26个英文字母、控制字符（回车键、退格、换行键等和阿拉伯数字用一个字节(八位二进制)来表示,这样最多可以定义256个字符，这个就是ASSIC码。在ASSIC码中，一共规定了128个字符，这些字符只占用了一个字节长度的后七位。
{% asset_img ascii1.png [ASCII码表1]%}
{% asset_img ascii1.png [ASCII码表2]%}
但是随着计算机的发展和普及，越来越多的国家开始使用计算机，不同的国家有不同的字母和语言，而传统的ASSIC的八位二进制最多表示256个字符显然已经满足不了各个国家的字符编码需求了。那么 *Unicode* 出现了。
## Unicode
Unicode的制定方是ISO(国际标准制定组织)，它们的解决方法简单除暴----把全世界的字母和符号都弄成一中编码方式表示，他们管这个叫Unicode标准。它定义Unicode字符集和Unicode的编码方式(后面会提到)。
Unicode规定字符的表示方式为 *U+* 加上一组十六进制数，这租十六进制数叫做**码点**，Unicode分十七个的平面，整体能表示的字符数量为2<sup>21</sup>。一个基本平面，表示的范围是**U+0000~U+FFFF**,另外十六个平面表示的范围是**U+010000~U+10FFFF**。
对于之前的ASSIC码表示的字符，则采用原先的ASSIC码来表示，只是在原先的ASSIC码的基础上在前面加8个0来组成两个字节(这种方式带来的问题是，对于前面127个字符，如果利用Unicode存储这会多浪费一个字节的空间)。其他的字符的编码也是对应排列下去，如果2个字节的长度还不能满足现有的字符，则用3个或4个字节来表示，等等。其实Unicode的字符表示方式给人的感觉是非常大气的，但是这种表示方式带来的问题也很多。
首先，就是前面提到的，对于原先的ASSIC码所对应的字符，在Unicode中表示的话则多浪费了一个字节的的存储空间。再一个就是全世界的字符非常多，那么就需要更长的字节来表示一个字符，那么对于原本只需要一个或两个字节表示的字符，我们现在给改为统一的3个或4个字节来表示，造成的结果解释前者的字符编码前面加了很多个0，这对于存储空间是个极大的浪费。Unicode的编码还无法来计算机知道，字符的编码长度，这样计算机也就不知道，这个编码是代表一个字符还是两个字符或者其他的。
所以早期的Unicode推广很不顺利，随着互联网的出现，这些问题都得到了解决，人们根据原来的Unicode的编码规则用不同的方式来进行实现，并一步一步的解决了这些问题。
### UTF-8编码
UTF-8是以字节为单位来对Unicode进行编码,它的编码方式可以总结为：
1. 对于单字节的符号，字节的第一位设为0，后面7位为这个符号的unicode码。因此对于英语字母，UTF-8编码和ASCII码是相同的。
2.
对于n字节的符号（n>1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的unicode码。
| Unicode编码(十六进制) | UTF-8 字节流(二进制)         |
| ------------- |:-------------:|
| 00000000 - 0000007F | 0xxxxxxx |
| 00000080 - 000007FF | 110xxxxx 10xxxxxx |
| 00000800 - 0000FFFF | 1110xxxx 10xxxxxx 10xxxxxx |
| 00200000 - 03FFFFFF | 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx |
| 04000000 - 7FFFFFFF | 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx |
UTF-8的特点是节省空间，它的前128个字符的编码和ASSIC码一样，都是用一个字节表示，它也就成为了当下计算机最流行的编码方式。

### UTF-32编码
UTF-32又称为**USC-4**。
UTF-32的编码都使用4个字节来表示一个字符，这种编码方式是最浪费存储空间的，但是优点就是方便查找，在HTML5的标准中，已经明确网页不能使用UTF-32来进行编码。

### UTF-16编码
在Unicode中的字符非常多，但是我们大多数人使用最平凡的则是0~65535以内的字符，也就是基本平面(BMP)只需要2两个字节就可以完全表示。于是就有了UTF-16编码，这是一种在字符存储空间和字符查找效率上综合的编码方式。
由于在基本平面内(BMP),从U+D800~U+DFFF是没有对应字符的(具体原因还有待解答)，那么在辅助平面上(SMP)，总共有16个平面。每个平面有2<sup>16</sup>个字符编码，那么总共是2<sup>20</sup>个编码。UTF-16将这20位拆成两半，前10位映射在U+D800到U+DBFF，称为**高位（H）** ，后10位映射在U+DC00到U+DFFF，称为**低位（L）** 。这意味着，一个辅助平面的字符，被拆成两个基本平面的字符表示。那么我们在高位的范围中发现了一个字符编码，于是我们用UTF-16的**对应规则**去低位寻找另外一个字符编码，这样，我们就组成了一个在辅助平面上的字符编码。
上面提到的对应规则具体为：
```
H = Math.floor((c-0x10000) / 0x400)+0xD800

L = (c - 0x10000) % 0x400 + 0xDC00
```
## 结语
这篇文章是根据阮大神的[Unicode与JavaScript详解](http://www.ruanyifeng.com/blog/2014/12/unicode.html)和吴秦的[字符集和字符编码](http://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html )的一些讲解加上自己的一些思考写出来的，但是这些毕竟不是官方文档的解释，所以肯定会有些错误，在日后的自己学习当中，会补充和修改。
总的来说，我在字符集相关方面的知识还是比较浅，还是需要在日后的一些实践中多多总结，它们的文中的有些点的讲解还是需要好好琢磨一下。
